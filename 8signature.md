署名

Entryに署名をつけることでユーザが承認したことを示す記録を残すことができます。グループにおけるメンバー承認のプロセスにおいても署名が使われます。

キーはselfまたはエイリアスに署名を付けることができます。ただし、キーのuidはログインユーザと一致する必要があります。つまり、/_user/{uid}で始まるキーに対してのみ署名可能です。そうでない場合、署名不可エラーとなります。

    <link rel="{self | alternate}" href="{キー}" title="{revision},{uid},{署名}" />
以下で署名を付与できます。

PUT {キー}?_signature&_revision={リビジョン(任意)}
正常に署名できた場合、HTTPステータスコード200(A signature has been applied.)が返ります。ログインしていない場合、401が、指定されたKeyに署名する権限がない場合、403が返ります。

既に署名が付いている場合は更新します。更新の際はRevisionを+1し、更新時刻を新たに設定します。署名ができるのは、idのキー、またはエイリアスのキーのみです。

以下で署名を削除できます。

DELETE {キー}?_signature
削除が成功すると、linkタグのtitle属性に"-"(署名削除)を設定します。(署名がないものとの区別が必要になるケースがあるため、ブランクにするのでなく、無効な値(-)をセットする必要があります。)

正常に署名を削除できた場合、HTTPステータスコード200が返ります。ログインしていない場合、401が、指定されたKeyに署名する権限がない場合、403が返ります。

署名削除の際も通常の更新と同じくRevisionを+1し、更新時刻を新たに設定します。

以下で署名を検証できます。

GET {キー}?_signature
指定するキーは、署名検証したいキーです。キーでなくエントリーそのものの参照権限がある場合、署名検証を可能とします。

正常に署名を検証できた場合、HTTPステータスコード200が返ります。署名が不正である場合、412(The signature is invalid.)が返ります。キーのエントリーそのものを参照する権限がない場合、403が返ります。
#### DoS攻撃対策

IP Blacklist

ブラックリストに登録することでDoS攻撃などの可能性があるリクエストを拒否（ブロック）できます。ブラックリストに登録されているユーザ・IPアドレスの組み合わせからのリクエストは認証エラーとなります。特定のIPから1000回(デフォルト)以上ログイン失敗でユーザ・IPアドレスの組み合わがブラックリストに自動的に追加されます。ブラックリストに追加されても異なるIPからログインすることは可能です。

ブラックリストは認証失敗カウンタによって管理します。認証失敗カウンタは、/_security/{アカウント認識文字列}/{IPアドレス}キーのカウンタが使われます。

アカウント認識文字列は、WSSEやRXIDの場合はアカウント (ユーザ名から使用不可文字を除去した文字列)が、AccessTokenやLinkTokenの場合はuidが使われる
ブラックリストのブロックは最後に認証失敗してから24時間後(デフォルト)に解除されます。または、認証失敗カウンタを0にすることでブロックを解除できます。具体的には以下のようなリクエストです。

ブロック解除

DELETE /d/_security/{アカウント認識文字列}/{IPアドレス}?_cachelong