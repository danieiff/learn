WebSocket

The WebSocketAPI allows to interact two communication between the user’s browser and the server

Creating a Websocket object

const ws = new WebSocket(url, protocols);
const ws = new WebSocket("wss://www.example.com/socketserver", "protocolOne");
const ws = new WebSocket("wss://www.example.com/socketserver",
["protocolOne", "protocolTwo"]);
Copy
const ws = new WebSocket('wss://localhost:8080')
ws.onopen = function(event) {
    const message = {
        type: 'Message',
        id: '1234-1234',
        text: 'Testing the Hello World',
        date: Date.now()
    }
    ws.send(JSON.stringify(message))
}


ws.onmessage = function(event) {// Receive messsage}
ws.close()
Copy
or

const ws = new WebSocket('wss://localhost:8080')
ws.addEventListener('open' , function(event) {
    const message = {
        type: 'Message',
        id: '1234-1234',
        text: 'Testing the Hello World',
            date: Date.now()
        }
        ws.send(JSON.stringify(message))
})


ws.onmessage = function(event) {// Receive messsage}
ws.close()
Copy
Integrating WebSocket with VTECX Framework#

Access Point URL: /w/{channel}/{group}
const ws = new WebSocket(‘wss://{service}.vte.cx/w/{channel}/{group}
__href, must include uid, account or '*' or '#'


const sendmsg = {
    summary:  "Content to be sent",
    link: [
       {
         ___rel: 'to',
         ___href: 'uid or account or * or #'
       }
   ]
};
Copy
Notify the user when there is error. The title will be error

const receivedmsg = {
    title: "error",
    summary: "Error Content",
};
Copy

### Group Creation

Group can be system group or user group
Add/Delete will be similar to the vte.cx specification
Group Creation Flow#

Group creation flow

USER 'A' (Group Owner)#

When a user register as a member, he/she will be given a "UID", eg: 123. UID assignment is generated by itself by the framework.

The following directory will be automatically generated when the membership registration is completed

/_user/123
/_user/123/accesskey
/_user/123/group
/_user/123/login_history
Additional directories are also added which are defined in /contrars-comm/setup/_settings/adduserinfo.xml

/_user/123/items
/_user/123/general
/_user/123/mail
/_user/123/bookmark
Adding Permission using contributor#

Created /talk_room/user_A_talk_room

const requestData = {
 feed: {
  entry: [
   {
      contributor: [
       {
         uri: 'urn:vte.cx:acl:123,CRUD'
       }
      ],
      link: [
       {
         ___rel 'self',
         ___href '/talk_room/user_A_talk_room'
        }
      ]
    }
  ]
 }
}
Copy
:123 represents to whom.

CRUD represents what permission to grant

User A (Group Owner)#

Updating Permission using contributor

Updated /talk_room/user_A_talk_room

const requestData = {
 feed: {
  entry: [
   {
      contributor: [
       {
         uri: 'urn:vte.cx:acl:/groupA,CRUD'
       }
      ],
      link: [
       {
         ___rel 'self',
         ___href '/talk_room/user_A_talk_room'
        }
      ]
    }
  ]
 }
}
Copy
In this groupA both userA and userB are present, Therefore, this allows both userA and userB to grant permission for the talk room.

User A (Group Owner)#

Create a group/directory#

The user is equipped with many directories

We will use /_user/123/group

Created /talk_room/user_A_talk_room Created /talk_room/user_A_talk_room/123

The bold section creates a group Created /_user/123/group Created /_user/123/group/user_A_talk_room Adding alias

Contributor specifies group and the owner, this guarantees the user’s permission

const requestData = {
 feed: {
  entry: [
   {
      contributor: [
       {
         uri: 'urn:vte.cx:acl:123,CRUD'
       },
       {
         uri: 'urn:vte.cx:acl:/talk_room/user_A_talk_room,CRUD'
       }
      ],
      link: [
       {
         ___rel 'self',
         ___href '/talk_room/user_A_talk_room'
        }
      ]
    },
    {
      link: [
        {
          ___rel 'self',
          ___href '/talk_room/user_A_talk_room/123'
        },
    {
          ___rel 'alternate',
          ___href '/_user/123/group/user_A_talk_room'
        },
      ]
    }
  ]
 }
}
Copy
User A (Group Owner)#

Register the UID of the userB in UserA Adding alias to B

const requestData = {
 feed: {
  entry: [
   {
      link: [
       {
         ___rel 'self',
         ___href '/talk_room/user_A_talk_room/987'
        },
       {
         ___rel 'alternate',
         ___href '/_user/987/group/user_A_talk_room'
        }
      ]
    }
  ]
 }
}
Copy
Add a signature to this user B directory

PUT /talk_room/user_A_talk_room/987?_signature

await commonAxios(
  states,
  '/d' + state.data.group + '/' + state.data.user_b_uid + '?_signature',
  'put'
)
Copy
User B#

prerequisites

self /talk_room/user_A_talk_room/987

alias /_user/987/group/user_A_talk_room

await commonAxios(
  states,
  '/d' + state.data.group + '/' + state.data.user_b_uid + '?_signature',
  'put'
)
Copy
PUT /_user/987/user_A_talk_room?_signature

SUMMARY#

Both UserA(id:123) and UserB(id:987) goes through registration
Internally for both users few directories created internally.
Extra directories created using adduserinfo.xml
UserA is the group owner
UserA creates a talkroom and group with permission /talk_room/user_A_talk_room/talk_room/user_A_talk_room/123
User A creates an alias/group for those talk /_user/123/group/_user/123/group/user_A_talk_room
UserA registers the uid of UserB /talk_room/user_A_talk_room/987/_user/987/group/user_A_talk_room
UserA creates a signature /talk_room/user_A_talk_room/987?_signature
User B create a talkroom and group with permission /talk_room/user_A_talk_room/talk_room/user_A_talk_room/987/_user/987/group/_user/987/group/user_A_talk_room
UserB accepts the signature by /_user/987/user_A_talk_room?_signature